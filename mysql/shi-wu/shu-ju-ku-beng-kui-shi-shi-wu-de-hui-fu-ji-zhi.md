## 数据库崩溃时事务的恢复机制（REDO日志和UNDO日志）？



### Undo Log

**Undo Log是为了实现事务的原子性**，在MySQL数据库InnoDB存储引擎中，还用了Undo Log来实现多版本并发控制\(简称：MVCC\)。

* **事务的原子性**\(Atomicity\)事务中的所有操作，要么全部完成，要么不做任何操作，不能只做部分操作。如果在执行的过程中发生了错误，要回滚\(Rollback\)到事务开始前的状态，就像这个事务从来没有执行过。

* **原理**Undo Log的原理很简单，**为了满足事务的原子性，在操作任何数据之前，首先将数据备份到一个地方（这个存储数据备份的地方称为UndoLog）**。然后进行数据的修改。如果出现了错误或者用户执行了ROLLBACK语句，**系统可以利用Undo Log中的备份将数据恢复到事务开始之前的状态**。

**之所以能同时保证原子性和持久化，是因为以下特点**：

* 更新数据前记录Undo log。
* 为了保证持久性，必须将数据在事务提交前写到磁盘。只要事务成功提交，数据必然已经持久化。
* **Undo log必须先于数据持久化到磁盘**。如果在G,H之间系统崩溃，**undo log是完整的， 可以用来回滚事务**。
* 如果在A-F之间系统崩溃,因为数据没有持久化到磁盘。所以磁盘上的数据还是保持在事务开始前的状态。

**缺陷**：**每个事务提交前将数据和Undo Log写入磁盘，这样会导致大量的磁盘IO，因此性能很低**。

如果能够将数据缓存一段时间，就能减少IO提高性能。但是这样就会丧失事务的持久性。因此引入了另外一种机制来实现持久化，即Redo Log。

## Redo Log

* **原理和Undo Log相反**，**Redo Log记录的是新数据的备份**。**在事务提交前，只要将Redo Log持久化即可，不需要将数据持久化。当系统崩溃时，虽然数据没有持久化，但是Redo Log已经持久化。系统可以根据Redo Log的内容，将所有数据恢复到最新的状态**。

> [\[转\]MySQL日志——Undo \| Redo](http://www.cnblogs.com/Bozh/archive/2013/03/18/2966494.html)



