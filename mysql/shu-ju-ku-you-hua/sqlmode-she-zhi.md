## SET SQL\_MODE="NO\_AUTO\_VALUE\_ON\_ZERO";

### 一、设置sql模式有什么作用？会产生什么方面的影响？

模式定义mysql会支持哪些sql语法。以及应执行哪种数据验证检查。最终达到的目标：适应在不同环境中适应mysql，因为可

以根据各自的程序不同设置对于德sql操作模式。输入如下语句可以知道，当前使用的sql模式，select @@sql\_mode 比如，NO\_AUTO\_VALUE\_ON\_ZERO模式下，根据字面意思，没有自动增量为0的值。

### 二、做一个实验：

步骤

**1.SET SQL\_MODE="NO\_AUTO\_VALUE\_ON\_ZERO"  您运行的 SQL 语句已经成功运行了。**

**2.SELECT @@sql\_mode**

```
mysql> SELECT @@sql_mode;
+-------------------------------------------------------------------------------------------------------------------------------------------+
| @@sql_mode                                                                                                                                |
+-------------------------------------------------------------------------------------------------------------------------------------------+
| ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |
+-------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```



**3.插入一条数据**

    INSERT INTO `julebu`.`matches` (
    `MATCHNO` ,
    `TEAMNO` ,
    `PLAYERNO` ,
    `WON` ,
    `LOST`
    )
    VALUES (
    '0', 'gg', 'ghh', 'hhh', 'hh'
    );

主键字段的值插入的值是0.结果看到，保存的并不是0，而变成了1。也正好说明了sql模式"NO\_AUTO\_VALUE\_ON\_ZERO"起作用

了。不允许自动增量的值为0\(手册：MySQL遇到0值一般会生成新的序列号\).经过进一步插入数据测试，注意理解这里的新序

列号：是生成新的序列号。遇到0，假如原来表中已经有个序列号是3，那么就会生成4.接着原来序列号的自增。



### 知识收集：

默认sql模式是为空的。非严格模式，难怪我们平时，插入一个字段，数据超过字段，不会报错，会自动截断存储。

使用严格模式\(STRICT\_TRANS\_TABLES\),插入的数据超过字段长度，比如常见的char字段类型，会报错，ERROR 1406 \(22001\): Data too long for column 'testchar' at row 1。

还有日期类型的字段。如果设置的值超过日期大小，也不会报错。

经验：mysql之所以默认设置为空。非严格模式，也是有道理的。这样容错性强。给一个设置级别给大家，也是可以方便自己根据需要来调试，一般是不太会使用严格模式的，严格模式造成程序很难跑起来，遇到点超过字段长度的错误，都会影响运行。

这个是什么意思好像和AUTO\_INCREMENT有关系请问到底有什么关系

NO\_AUTO\_VALUE\_ON\_ZERO影响AUTO\_INCREMENT列的处理。一般情况，你可以向该列插入NULL或0生成下一个序列号。NO\_AUTO\_VALUE\_ON\_ZERO禁用0，因此只有NULL可以生成下一个序列号。

如果将0保存到表的AUTO\_INCREMENT列，该模式会很有用。\(不推荐采用该惯例\)。例如，如果你用mysqldump转储表并重载，MySQL遇到0值一般会生成新的序列号，生成的表的内容与转储的表不同。重载转储文件前启用NO\_AUTO\_VALUE\_ON\_ZERO可以解决该问题。

